---
# Install packages on bastion host
# Use connection vars instead of delegate_to for cleaner execution

- name: Install python3-pip on bastion
  vars:
    ansible_host: "{{ bastion_ansible_host }}"
    ansible_user: "{{ bastion_ansible_user }}"
    ansible_ssh_pass: "{{ bastion_ansible_ssh_pass }}"
    ansible_port: "{{ bastion_ansible_port | default(22) }}"
  become: true
  ansible.builtin.dnf:
    name: python3-pip
    state: present

- name: Install awscli via pip on bastion
  vars:
    ansible_host: "{{ bastion_ansible_host }}"
    ansible_user: "{{ bastion_ansible_user }}"
    ansible_ssh_pass: "{{ bastion_ansible_ssh_pass }}"
    ansible_port: "{{ bastion_ansible_port | default(22) }}"
  become: false
  ansible.builtin.pip:
    name: awscli
    state: present
    executable: pip3
    extra_args: --user
